# :page_facing_up: Document Databases: Storage Technology Flavor

## 1. Introduction

A document database stores data in document format, often using JSON or BSON, 
as opposed to traditional SQL databases. This approach is commonly referred to as NoSQL. 
This article explores the advantages of document databases and compares various implementations.

## 2. Databases under discussion

The databases being discussed here are only self-hostable. However, some companies also offer a cloud version.

## CouchDB (Apache)
CouchDB represents a comprehensive open-source document database, devoid of any premium licensing requirements. Every feature is encompassed within the sole existing version.

## MongoDB
MongoDB, an open-source document database, offers both a premium self-hosted and cloud-hosted version.

## RavenDB
As a document database, RavenDB proffers a community edition at no cost, although it is not open-source. Premium self-hosted and cloud-hosted alternatives are provided as well.

Future databases to consider:

### Couchbase (Apache)
### Cassandra
### Neo4j
### PostgreSQL with JSONB
### SQL Server wiht JSON column

## 3. CRUD Operations

### Considerations

This chapter explores the CRUD (Create, Read, Update, Delete) capabilities of document databases.

### MongoDb

A document is stored in a collection, and collections are stored in a database. MongoDB provides a user-friendly client driver for performing CRUD operations on documents. Collections have no schema, allowing multiple types of documents to be stored together. It is recommended to group similar documents in a collection. MongoDB also offers a convenient feature where databases and collections are created automatically when saving documents, saving time compared to SQL databases where an SQL script is required for creating both the database and tables.

### RavenDb

Documents reside within collections, and these collections find their storage within databases. An EntityFramework-like client, offered by RavenDB, facilitates operations on documents. The lack of a schema in collections permits the storage of various types of documents concurrently.

The creation of databases is not an automatic process associated with the production of documents. Instead, a dedicated initialization of a database is requisite prior to engaging with documents. However, the creation of collections coincides automatically with document generation.

A restriction exists within document properties: GUID type is non-permissible. Consequently, unique identifiers require serialization and deserialization in the code.


## 4. Indexes, Composed Keys

### Considerations

This chapter explores indexes and composed keys in document databases.

### MongoDb

MongoDB creates a unique "_id" property by default for every document, saved as binary data. If the document already has an ID property when being saved, it will overwrite the value generated by MongoDB. The client driver can be configured to display the ID as a GUID value when exploring the database with MongoDB Compass GUI application. Furthermore, additional indexes can be created on other properties, including composed keys of multiple properties.

### RavenDb

RavenDB generates an auto-index for document identities. Index creation can be accomplished on a singular property, multiple properties, or even properties spanning various document types (Multi-Map). Additionally, RavenDB supports the application of Map-Reduce indexes.

## 5. Querying, Sorting, Pagination

### Considerations

This chapter explores the capabilities of filtering, sorting, and pagination in document databases.

### MongoDb

The client drivers offer filtering, sorting, and pagination functionality when retrieving documents. The filter function in the client driver follows the specification pattern, where a filter must be created as a separate object and passed to the function. The client also offers a fluent API, similar to LINQ, for performing these operations in a chained fashion.

### RavenDb

Client drivers facilitate filtering, sorting, and pagination operations during document retrieval. A LINQ expression, akin to the EntityFramework-style, is provided through the client driver API for querying documents.

## 6. Schema(less), Constraints, Projections, Views

### Considerations

This chapter explores the schemaless nature of documents, absence of constraints, and the capabilities to project and create views in document databases.

### MongoDb

Documents in MongoDB are schemaless, allowing fields to be added or removed without affecting others in the collection. While this may create some uncertainty as documents do not have a fixed structure, it can also be advantageous as it allows the application to determine which fields the documents should have.

Properties of documents in MongoDB do not have constraints, allowing them to be added, modified, or removed without any restrictions.

MongoDB allows for the creation of views, which can be derived from one or multiple documents in the database.

### RavenDB

RavenDB's documents possess a schemaless nature, enabling the addition or removal of fields without implications on others within the collection. Projections can serve as the basis for document retrieval, and views are capable of being created and stored.

Unconstrained by restrictions, properties within RavenDB's documents permit the addition, modification, or removal freely.

## 7. Partial Updates, Partitioning, Concurrency, Transactions

### Considerations

This chapter explores the ability to partially update a document, partitioning, and the concurrency aspect of document databases.

### MongoDb

MongoDB client drivers support partial updates on document properties. These operations are atomic and can be executed concurrently. 

MongoDB provides horizontal scaling through sharding, where data is partitioned into chunks and distributed across multiple machines. A shard collection must be created with the shard key, and the database engine handles the chunks.

By default, the mongo client does not use the unit of work pattern when interacting with documents. Actions are atomic only on documents, and databases and collections can be accessed concurrently. However, using partial update features, documents can be updated atomically at the property level, minimizing the risk of collisions. In cases where multiple documents must be updated in a single transaction, the client offers a session feature. A session allows multiple documents to be modified without committing changes until a dedicated commit method is called.

### RavenDb

Document patching is a feature supported by RavenDB, allowing the update of individual properties.

Partitioning in RavenDB is exclusively supported on the document ID through a mechanism known as Sharding, which is largely automated when multiple nodes are connected in a cluster.

Interactions with documents in RavenDB strictly adhere to the "unit of work" pattern. This pattern encapsulates CRUD operations within a transaction, allowing these operations to be performed on multiple documents.

## 8. Metadata, Versioning

### Considerations

This chapter explores the ability to add metadata to documents and provide a versioning feature in document databases.

### MongoDb

In MongoDB, metadata can be added to a document by including additional fields within the document itself. Unlike relational databases, MongoDB does not have a separate metadata table or mechanism to store metadata. Instead, you can simply add more fields to your document to store the necessary metadata.

Similarly, document versioning can be implemented in MongoDB by adding version-related fields to your document and creating a separate collection to store the previous versions of a document.

### RavenDb

RavenDB allows for the enhancement of documents with additional metadata, which does not result in the addition of extra fields to the document itself. This metadata exists alongside the document.

Furthermore, RavenDB facilitates collection versioning. Consequently, when a CRUD operation is executed on a document within a collection, a preceding version of the document is concurrently preserved.

## 9. Quality of client SDK for dotnet

### Considerations

This chapter explores the ease of use and resiliency of the .NET client driver for MongoDB in C#.

### MongoDb

The MongoDB client driver is lightweight and easy to use. However, there can be some issues when specifying a connection string, particularly when using account authentication. The connection string must be a URL encoded string value, and some special characters in the password may break the connection string.

The client driver performs atomic operations, but retries are only possible if the deployed server is an enterprise version.

The client driver uses a connection pool to communicate with the server, allowing for efficient reuse of connections and improved performance.

When connected to a replica set, the client driver has the ability to select and communicate with healthy servers based on a server selection criteria. This helps to ensure high availability and robustness in the face of network failures or other issues.

### RavenDb

RavenDB provides a fully supported C# client driver via a NuGet package. The API bears similarities to EntityFramework, with operations executed within a unit of work, and comprehensive support for the query language in the form of LINQ expressions.

In certain aspects, the API might not be as intuitive as client drivers from other NoSQL database providers. Despite the presence of documentation, certain elements might be challenging to decipher.

Nevertheless, RavenDB possesses a notable edge, given the extensive features of the client driver, its support from the official team, and the detailed documentation.


## 10. Installation, Setup, and Other Infrastructure Notices

### Considerations

This chapter explores the ease of installing a document database as an infrastructure specialist.

### MongoDb

The database server comes with a docker image which can pe spinned in to a container. Initial administrator credentials can be specific through environment variables and the data can also be stored in a dedicated docker volume.

MongoDB Compass is available as a CRUD explorer of MongoDB databases. 

### RavenDb

RavenDB's database server is accompanied by a Docker image, capable of being launched into a container. However, the setup process may not be entirely intuitive, and the database solely supports certificate authentication.

A CRUD explorer, known as RavenStudio, is included by default with the database server, presented as a WebUI.

Of note is the fact that while the community edition is free, enabling certain "free" features necessitates additional online steps.

## 11. Other

### Schemaless and constraintless nature of document databases

Unlike SQL databases, document databases do not have mechanisms in place to prevent administrators from mistakenly modifying documents, which can result in the loss of valuable data. Therefore, it is recommended that documents be accessed mostly through dedicated applications rather than a general CRUD application like MongoDB Compass. Administrators should be cautious when updating data manually. Writing a dedicated application may be more time-consuming, but it is a safer approach to modify data as updating documents directly can be unsafe. 

### No relationships

In the real world, not all objects have relationships between them. Different types of objects can coexist without a relationship between them. For example, in the context of customers and invoices, invoices may be created without being related to a specific customer.

However, the lack of relationships in document databases can disadvantageous, as documents can be deleted and break the consistency of the data. This can subsequently cause problems and break certain features.